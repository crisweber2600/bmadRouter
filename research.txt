Nice ‚Äî I see what you‚Äôre doing here: you asked the Quick-Flow agent to ‚Äúresearch notdiamond supported models. then add debug logging‚Äù, and now you‚Äôre ready for the next bit.

Let‚Äôs give you exactly what you need so the BMADRouterPlugin ‚Üí OpenCode ‚Üí NotDiamond compatibility layer becomes clean and systematically debuggable.

‚∏ª

‚úÖ 1. NotDiamond Supported Models (current landscape)

NotDiamond does not expose a single universal ‚Äúmodel list‚Äù endpoint, but the supported provider/model tuples can be inferred from:

A) Official provider integrations

Current public integrations include (most stable):

Providers
	‚Ä¢	openai
	‚Ä¢	anthropic
	‚Ä¢	google
	‚Ä¢	meta (llama)
	‚Ä¢	x.ai
	‚Ä¢	mistral
	‚Ä¢	fireworks
	‚Ä¢	together
	‚Ä¢	perplexity
	‚Ä¢	deepseek
	‚Ä¢	cohere

Each provider then exposes one or more model IDs in ND‚Äôs expected format:

‚∏ª

Example ND-Conformant Model Strings

Provider	ND Model ID Example	Notes
openai	openai/gpt-4.1 / openai/gpt-4o-mini	Very stable
anthropic	anthropic/claude-3-5-sonnet	Your fallback ‚Äúsafe‚Äù choice
google	google/gemini-1.5-pro / gemini-1.5-flash	Supported
meta	meta/llama-3.1-70b-instruct	Via Fireworks/Together
x.ai	xai/grok-beta	Activation varies
mistral	mistral/mistral-large-2407 / mistral-small	Solid
fireworks	fireworks/llama-v3-70b-instruct	Usually via Fireworks
together	together/llama3-405b-instruct	Good throughput
perplexity	perplexity/pplx-70b-online	Search-enabled
deepseek	deepseek/deepseek-coder	Fine for coding
cohere	cohere/command-r	Reasoning tier


‚∏ª

üß© 2. What matters for OpenCode

NotDiamond expects a payload shaped like:

{
  "model": "anthropic/claude-3-5-sonnet",
  "messages": [...],
  "temperature": 0.2,
  "provider": "anthropic"
}

OpenCode plugins often provide:

provider: "anthropic",
model: "claude-3-5-sonnet"

‚Üí mismatch creates the 500 you‚Äôre seeing

‚∏ª

üß± 3. Mapping Layer (fix the mismatch)

You want a lookup table:

const ND_MAP = {
  "anthropic:claude-3-5-sonnet": "anthropic/claude-3-5-sonnet",
  "openai:gpt-4.1": "openai/gpt-4.1",
  "openai:gpt-4o-mini": "openai/gpt-4o-mini",
  "google:gemini-1.5-pro": "google/gemini-1.5-pro",
};

Fallback rule:

{provider}:{model} ‚Üí {provider}/{model}

But only apply if a known provider.

‚∏ª

üêõ 4. Add Debug Logging (payload + response)

Drop this into your NotDiamond transport:

async function callND(payload) {
  console.debug("[ND:REQUEST]", JSON.stringify(payload, null, 2));

  const res = await fetch(ND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload),
  });

  console.debug("[ND:STATUS]", res.status);

  let text = await res.text();
  console.debug("[ND:RESPONSE]", text);

  try {
    return JSON.parse(text);
  } catch (e) {
    console.error("[ND:PARSE_ERROR]", e);
    throw new Error(`ND parse error: ${text.slice(0, 200)}`);
  }
}

This gives you:
‚úî payload echo
‚úî HTTP status
‚úî raw text (super important for 500/502)
‚úî parse guard

‚∏ª

üîÅ 5. Optional: Fallback Model Patch

Inside BMADRouterPlugin:

const FALLBACK = [
  "openai/gpt-4o-mini",
  "anthropic/claude-3-5-sonnet",
  "google/gemini-1.5-flash"
];

if (ndError) {
  use(FALLBACK[0]);
}

Keeps BMAD workflows alive during quota/model mismatches.

‚∏ª

üß† 6. Integrate With Your BMAD Strategy

Your earlier BMAD router goals:

prefer Anthropic ‚Üí OpenAI ‚Üí Copilot
detect MBAM quick Q&A to avoid burning Copilot premium
use status.yaml to detect phase
quota-aware routing

ND works well as the final arbitration step, not the prime router:

BMADRouter ‚Üí Candidate Set ‚Üí NotDiamond ‚Üí Executor


‚∏ª

üéØ Your Next Move Options

Tell me what you want now:

1Ô∏è‚É£ produce a full OpenCode plugin that implements this
2Ô∏è‚É£ inject into existing plugin (you paste code, I modify)
3Ô∏è‚É£ debug running config (paste logs/screenshots)
4Ô∏è‚É£ extend to quota reasoning
5Ô∏è‚É£ extend to BMAD workflow parsing
6Ô∏è‚É£ wire in Copilot as tertiary reasoning model

Just reply with:
1, 2, 3, 4, 5, or 6 ‚Äî or say ‚Äúfull BMAD router‚Äù if you want the whole system stitched together end-to-end.

‚∏ª

If you want, I‚Äôll also give you:

‚úî official ND provider/model inventory scraper
‚úî model ID normalization rules
‚úî quota signals and routing logic
‚úî BMAD stage ‚Üí model class mapping (very powerful)
